import telebot
import time
from telebot import types

# üîë –¢–æ–∫–µ–Ω —Ç–≤–æ–µ–≥–æ –±–æ—Ç–∞
TOKEN = "8149460454:AAGkOO3sqj14wjw2D3ECSY6zXOzAmUuOARs"
CHANNEL_ID = "@rabotavbishkeke01"  # –¢–≤–æ–π –∫–∞–Ω–∞–ª
ADMIN_ID = 958991991  # –¢–≤–æ–π Telegram ID

bot = telebot.TeleBot(TOKEN)

last_post_time = {}  # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

@bot.message_handler(commands=['start'])
def start(message):
    bot.send_message(message.chat.id, "–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç –¥–ª—è –≤–∞–∫–∞–Ω—Å–∏–π –∏ –∞–Ω–∫–µ—Ç.\n–ß—Ç–æ–±—ã —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –ø–æ—Å—Ç, –Ω–∞–ø–∏—à–∏ /post")

@bot.message_handler(commands=['post'])
def create_post(message):
    now = time.time()
    if message.from_user.id in last_post_time and now - last_post_time[message.from_user.id] < 3600:
        bot.send_message(message.chat.id, "‚ùå –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å –º–æ–∂–Ω–æ –Ω–µ —á–∞—â–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞ –≤ —á–∞—Å.")
        return
    msg = bot.send_message(message.chat.id, "–û—Ç–ø—Ä–∞–≤—å —Ç–µ–∫—Å—Ç –≤–∞–∫–∞–Ω—Å–∏–∏ –∏–ª–∏ –∞–Ω–∫–µ—Ç—ã:")
    bot.register_next_step_handler(msg, process_post)

def process_post(message):
    text = message.text
    keyboard = types.InlineKeyboardMarkup()
    keyboard.add(types.InlineKeyboardButton("üì© –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è", url=f"https://t.me/{bot.get_me().username}?start=reply"))
    keyboard.add(types.InlineKeyboardButton("üìû –°–≤—è–∑–∞—Ç—å—Å—è", callback_data=f"contact|{message.from_user.username}|{text}"))
    keyboard.add(types.InlineKeyboardButton("üóë –£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç", callback_data=f"delete|{message.from_user.id}"))

    bot.send_message(CHANNEL_ID, text, reply_markup=keyboard)
    last_post_time[message.from_user.id] = time.time()
    bot.send_message(message.chat.id, "‚úÖ –ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!")

@bot.callback_query_handler(func=lambda call: True)
def callback_handler(call):
    parts = call.data.split("|")
    action = parts[0]

    if action == "contact":
        username = parts[1]
        post_text = parts[2] if len(parts) > 2 else "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"
        contact_link = f"https://t.me/{username}" if username else "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫—Ä—ã–ª –∫–æ–Ω—Ç–∞–∫—Ç"
        bot.send_message(call.message.chat.id, f"üìå –í–∞–∫–∞–Ω—Å–∏—è/–∞–Ω–∫–µ—Ç–∞:\n{post_text}\n\n–°–≤—è–∑–∞—Ç—å—Å—è: {contact_link}")
    elif action == "delete":
        user_id = parts[1]
        if str(call.from_user.id) == user_id or call.from_user.id == ADMIN_ID:
            bot.delete_message(call.message.chat.id, call.message.message_id)
            bot.send_message(call.from_user.id, "üóë –ü–æ—Å—Ç —É–¥–∞–ª—ë–Ω.")
        else:
            bot.send_message(call.from_user.id, "‚ùå –£–¥–∞–ª—è—Ç—å –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä –∏–ª–∏ –∞–¥–º–∏–Ω.")

print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
bot.polling(none_stop=True)
